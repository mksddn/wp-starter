# Forms Handler - WordPress Plugin

Универсальная система обработки форм для WordPress с поддержкой REST API, валидации, отправки email, уведомлений в Telegram, интеграции с Google Sheets и сохранения заявок в админке.

## Возможности

✅ **REST API** - отправка форм через API  
✅ **Шорткоды** - встраивание форм на страницы  
✅ **Валидация** - проверка обязательных полей и email  
✅ **Email отправка** - настройка получателей, темы, BCC  
✅ **Telegram уведомления** - мгновенные уведомления в Telegram  
✅ **Google Sheets интеграция** - автоматическое сохранение в таблицы  
✅ **Сохранение заявок** - все заявки сохраняются в админке  
✅ **Экспорт данных** - выгрузка заявок в CSV с фильтрацией  
✅ **Безопасность** - фильтрация полей, CSRF защита, логирование  

## Создание формы
1. Перейдите в **Forms** → **Add New**
2. Заполните основные настройки:
   - Recipients (email адреса через запятую)
   - Fields Configuration (JSON конфигурация полей)

### Telegram настройка

**Получение Bot Token:**
1. Найдите @BotFather в Telegram
2. Отправьте `/newbot` и следуйте инструкциям
3. Скопируйте полученный токен (например: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

**Получение Chat ID:**
1. Добавьте бота в нужный чат/канал/группу
2. Отправьте сообщение в чат/канал/группу
3. Перейдите: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Найдите `chat.id` в ответе (например: `-1001234567890`)

### Google Sheets Настройка

1. Следуйте инструкции на странице **Settings** → **Google Sheets Settings**

## Использование
- **Шорткод**: `[form id="contact-form"]`
- **REST API**: `POST /wp-json/wp/v2/forms/contact-form/submit`

## Безопасность (реализованные меры защиты)

#### 1. Фильтрация полей
- ✅ Принимаются только поля, указанные в конфигурации формы
- ✅ Защита от инъекции дополнительных полей
- ✅ Логирование попыток отправки неразрешенных полей

#### 2. Валидация данных
- ✅ Проверка обязательных полей
- ✅ Валидация email адресов
- ✅ Ограничение длины полей (максимум 10,000 символов)
- ✅ Проверка общего размера данных (максимум 100KB)

#### 3. CSRF защита
- ✅ WordPress nonce для всех форм
- ✅ Защита от Cross-Site Request Forgery атак

#### 4. Ограничения запросов
- ✅ Максимум 50 полей в одном запросе
- ✅ Защита от DoS атак через большие запросы

#### 5. Санитизация данных
- ✅ Очистка всех входящих данных
- ✅ Защита от XSS и инъекций

## Возможные проблемы
1. **Форма не отправляется** - проверьте конфигурацию полей
2. **Email не приходит** - проверьте настройки SMTP
3. **Telegram не работает** - проверьте Bot Token и Chat ID
4. **Google Sheets не сохраняет** - проверьте OAuth настройки